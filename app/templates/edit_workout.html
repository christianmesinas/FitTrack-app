{% extends "base.html" %}

{% block content %}
<div class="top-bar">
  <a href="{{ url_for('main.index') }}">
    <img src="{{ url_for('static', filename='img/back.svg') }}" alt="Back">
  </a>
</div>

<section class="header-section">
  <form method="POST" action="{{ url_for('main.edit_workout', plan_id=workout_plan.id) }}" class="add-workout-form">
    {{ form.hidden_tag() }}

<div class="workout-name">
  <h1>{{ form.name.label }}</h1>
  {{ form.name(placeholder="Naam van workout", required=True) }}
  {% if form.name.errors %}
    <ul class="errors">
      {% for error in form.name.errors %}
        <li>{{ error }}</li>
      {% endfor %}
    </ul>
  {% endif %}
</div>

    <section class="exercise-blok-section">
      {% if exercise_pairs %}
        {% for plan_exercise, exercise_form in exercise_pairs %}
          {% set exercise_obj = exercises_dict.get(plan_exercise.exercise_id|string) %}
          <section class="active-workout-block" data-exercise-id="{{ plan_exercise.exercise_id }}">
            <!-- Drie-puntjes knop -->
            <div class="setting-dots-workout">â‹¯</div>

            <!-- Instellingenmenu -->
            <div class="settings-menu" style="display:none;">
              <form method="POST" action="{{ url_for('main.delete_exercise_from_plan', plan_id=workout_plan.id) }}" style="margin:0;">
                {{ delete_exercise_form.csrf_token }}
                <input type="hidden" name="workout_plan_exercise_id" value="{{ plan_exercise.id }}">
                <button type="submit" class="btn-delete-exercise" style="background:none; border:none; color:red; cursor:pointer; padding:0;">Verwijder oefening</button>
              </form>
            </div>

            {% if exercise_obj and exercise_obj.images_list %}
              <img class="exercise-block-img" src="{{ url_for('static', filename='img/exercises/' + exercise_obj.images_list[0]) }}" alt="{{ exercise_obj.name }}">
            {% else %}
              <p>Geen afbeeldingen beschikbaar</p>
            {% endif %}

            <h2>{{ exercise_obj.name if exercise_obj else "Onbekende oefening" }}</h2>

  <div class="exercise-details displayNone">
  {{ exercise_form.hidden_tag() }}
  {{ exercise_form.exercise_id(hidden=True, value=exercise_form.exercise_id.data|default(None)) }}
{{ exercise_form.order(hidden=True, value=exercise_form.order.data | int) }}
  <div class="form-group">
    <label for="{{ exercise_form.sets.id }}">Sets</label>
    {{ exercise_form.sets(class="form-control", type="number", min="0") }}
    {% if exercise_form.sets.errors %}
      <ul class="errors">
        {% for error in exercise_form.sets.errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
  <div class="form-group">
    <label for="{{ exercise_form.reps.id }}">Reps</label>
    {{ exercise_form.reps(class="form-control", type="number", min="0") }}
    {% if exercise_form.reps.errors %}
      <ul class="errors">
        {% for error in exercise_form.reps.errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
  <div class="form-group">
    <label for="{{ exercise_form.weight.id }}">Gewicht (kg)</label>
    {{ exercise_form.weight(class="form-control", type="number", step="0.1", min="0") }}
    {% if exercise_form.weight.errors %}
      <ul class="errors">
        {% for error in exercise_form.weight.errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
</div>
          </section>
        {% endfor %}
      {% else %}
        <p>Je hebt nog geen oefeningen toegevoegd.</p>
      {% endif %}

      <a href="{{ url_for('main.search_exercise', plan_id=workout_plan.id) }}" class="second-grey-cta-btn">Add exercise</a>
      {{ form.submit(value="Update workout", class="orange-btn-outline add-new-workout-btn") }}
    </form>

    <form method="POST" action="{{ url_for('main.remove_workout', plan_id=workout_plan.id) }}" onsubmit="return confirm('Weet je zeker dat je deze workout wilt verwijderen?');">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <button type="submit" class="btn btn-danger">Verwijder hele workout</button>
    </form>
  </section>
</section>

<script>
// JavaScript voor toggle menu bij de drie-puntjes
document.querySelectorAll('.setting-dots-workout').forEach(dot => {
  dot.addEventListener('click', (e) => {
    e.preventDefault();
    // Sluit andere menu's
    document.querySelectorAll('.settings-menu').forEach(menu => {
      if (menu !== dot.nextElementSibling) {
        menu.style.display = 'none';
      }
    });
    // Toggle dit menu
    const menu = dot.nextElementSibling;
    menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
  });
});

// Sluit menu als ergens anders geklikt wordt
document.addEventListener('click', (e) => {
  if (!e.target.closest('.setting-dots-workout') && !e.target.closest('.settings-menu')) {
    document.querySelectorAll('.settings-menu').forEach(menu => menu.style.display = 'none');
  }
});
</script>
{% endblock %}