{% extends "base.html" %}

{% block head %}
<!-- Dans le <head> -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/workout-creation.css') }}">
<script src="{{ url_for('static', filename='js/workout-creation.js') }}"></script>
{% endblock %}



{% block content %}
<div class="top-bar">
    <a href="{{ url_for('main.index') }}">
        <img src="{{ url_for('static', filename='img/back.svg') }}" alt="back button" class="back-icon" aria-label="Go back"/>
    </a>
</div>

<!-- Guide de progression -->
<div class="workout-creation-progress">
    <div class="progress-steps">
        <div class="step active" data-step="1">
            <span class="step-number">1</span>
            <span class="step-label">Naam workout</span>
        </div>
        <div class="step" data-step="2">
            <span class="step-number">2</span>
            <span class="step-label">Voeg oefeningen toe</span>
        </div>
        <div class="step" data-step="3">
            <span class="step-number">3</span>
            <span class="step-label">Configureer sets</span>
        </div>
    </div>
</div>

<section class="header-section add-workout-blok">
    <form method="POST" id="workout-form">
        {{ form.hidden_tag() }}

        <!-- Stap 1: Naam van workout -->
        <div class="workout-step step-1-content">
            <div class="step-instruction">
                <h2>üí™ Laten we beginnen met je nieuwe workout!</h2>
                <p class="help-text">Geef je workout een naam die je motiveert. Bijvoorbeeld: "Maandag Upper Body" of "HIIT Cardio Blast"</p>
            </div>

            <div class="workout-name">
                {{ form.name.label }}
                {{ form.name(placeholder="bijv. Full Body Strength", required=True, class="workout-name-input") }}
                {% if form.name.errors %}
                    <ul class="errors">
                        {% for error in form.name.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                <!-- Suggesties voor workout namen -->
                <div class="name-suggestions">
                    <p class="suggestion-label">Populaire workout namen:</p>
                    <div class="suggestion-chips">
                        <span class="chip" onclick="setWorkoutName('Push Day')">Push Day</span>
                        <span class="chip" onclick="setWorkoutName('Pull Day')">Pull Day</span>
                        <span class="chip" onclick="setWorkoutName('Leg Day')">Leg Day</span>
                        <span class="chip" onclick="setWorkoutName('Full Body')">Full Body</span>
                        <span class="chip" onclick="setWorkoutName('Cardio & Core')">Cardio & Core</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stap 2: Oefeningen -->
        <section class="exercise-blok-section">
            <div class="step-instruction" id="exercise-instruction" style="display: none;">
                <h3>üéØ Tijd om oefeningen toe te voegen!</h3>
                <p class="help-text">Klik op de knop hieronder om oefeningen te zoeken en aan je workout toe te voegen</p>
            </div>

            <!-- Empty state met begeleiding -->
            <div class="empty-workout-state" id="empty-state">
                <div class="empty-icon">üèãÔ∏è</div>
                <h3>Je workout is nog leeg</h3>
                <p>Voeg eerst een naam toe hierboven, dan kun je oefeningen toevoegen!</p>

                <!-- Tips sectie -->
                <div class="workout-tips">
                    <h4>üí° Tips voor een goede workout:</h4>
                    <ul>
                        <li>Begin met 3-5 oefeningen voor een balanced workout</li>
                        <li>Mix compound oefeningen (zoals squats) met isolation oefeningen</li>
                        <li>Zorg voor rust tussen muscle groups</li>
                        <li>Start met minder sets en bouw langzaam op</li>
                    </ul>
                </div>
            </div>

            <!-- Bestaande oefeningen (als die er zijn) -->
            {% if exercises %}
                <div class="exercises-list" id="exercises-list">
                    <h3>Je oefeningen:</h3>
                    {% for exercise in exercises %}
                        <section class="active-workout-block" data-exercise-id="{{ exercise.exercise_id }}">
                            <img class="drag-drop-icon" src="{{ url_for('static', filename='img/drag-drop.svg') }}" alt="drag-and-drop">
                            <a href="#" class="setting-dots-workout" data-action="edit" data-exercise-id="{{ exercise.exercise_id }}">...</a>
                            <h2>{{ exercise.exercise.name }}</h2>
                            <section class="set-section">
                                {% for i in range(exercise.sets) %}
                                    <div class="active-workout-set">
                                        <input type="number" name="reps-{{ exercise.id }}-{{ i }}" min="0" step="1" placeholder="{{ exercise.reps }} reps" value="{{ exercise.reps }}">
                                        <input type="number" name="weight-{{ exercise.id }}-{{ i }}" min="0" step="0.1" placeholder="{{ exercise.weight }} kg" value="{{ exercise.weight }}">
                                        <label class="custom-checkbox">
                                            <input type="checkbox" name="completed-{{ exercise.id }}-{{ i }}">
                                            <span class="checkmark"></span>
                                        </label>
                                    </div>
                                {% endfor %}
                            </section>
                        </section>
                    {% endfor %}
                </div>
            {% endif %}

            <!-- Formulier voor nieuwe oefeningen (verborgen) -->
            <div id="exercise-forms" style="display: none;">
                {% for exercise_form in form.exercises %}
                    <section class="active-workout-block">
                        {{ exercise_form.hidden_tag() }}
                        <!-- Exercise form fields... -->
                    </section>
                {% endfor %}
            </div>

            <!-- Action buttons -->
            <div class="workout-actions">
                <a href="{{ url_for('workouts.search_exercise', plan_id=0) }}"
                   class="second-grey-cta-btn add-exercise-btn"
                   id="add-exercise-btn"
                   style="display: none;">
                    <span class="btn-icon">‚ûï</span> Voeg oefening toe
                </a>

                {{ form.submit(class="orange-btn-outline add-new-workout-btn",
                              value="Maak workout aan",
                              id="submit-btn",
                              disabled=True) }}
            </div>

            <!-- Motiverende boodschap -->
            <div class="motivation-message" id="motivation" style="display: none;">
                <p class="motivation-text">üî• Geweldig! Je bent goed bezig met het maken van je workout!</p>
            </div>
        </section>
    </form>
</section>

<style>
/* Progress indicator */
.workout-creation-progress {
    max-width: 700px;
    margin: 30px auto;
    padding: 0 20px;
}

.progress-steps {
    display: flex;
    justify-content: space-between;
    position: relative;
    margin-bottom: 40px;
}

.progress-steps::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 2px;
    background: #e0e0e0;
    z-index: 0;
}

.step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 1;
    opacity: 0.5;
    transition: opacity 0.3s ease;
}

.step.active {
    opacity: 1;
}

.step-number {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: white;
    border: 2px solid #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    margin-bottom: 8px;
    transition: all 0.3s ease;
}

.step.active .step-number {
    background: #FF914B;
    color: white;
    border-color: #FF914B;
    transform: scale(1.1);
}

.step-label {
    font-size: 12px;
    text-align: center;
    max-width: 100px;
}

/* Instructies en hulp */
.step-instruction {
    background: linear-gradient(135deg, rgba(255,145,75,0.05) 0%, rgba(255,145,75,0.1) 100%);
    border-left: 4px solid #FF914B;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 30px;
    animation: slideIn 0.5s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.step-instruction h2, .step-instruction h3 {
    margin: 0 0 10px 0;
    color: #333;
}

.help-text {
    color: #666;
    margin: 0;
    font-size: 14px;
    line-height: 1.5;
}

/* Naam suggesties */
.name-suggestions {
    margin-top: 20px;
    padding: 15px;
    background: #f8f8f8;
    border-radius: 8px;
    animation: fadeIn 0.5s ease;
}

.suggestion-label {
    font-size: 12px;
    color: #888;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.suggestion-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.chip {
    padding: 6px 12px;
    background: white;
    border: 1px solid #ddd;
    border-radius: 20px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.chip:hover {
    background: #FF914B;
    color: white;
    border-color: #FF914B;
    transform: translateY(-2px);
}

/* Empty state */
.empty-workout-state {
    text-align: center;
    padding: 60px 20px;
    background: #f9f9f9;
    border-radius: 15px;
    margin: 30px auto;
    max-width: 500px;
    animation: fadeIn 0.8s ease;
}

.empty-icon {
    font-size: 60px;
    margin-bottom: 20px;
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.empty-workout-state h3 {
    color: #333;
    margin-bottom: 10px;
}

.empty-workout-state p {
    color: #666;
    margin-bottom: 30px;
}

/* Tips sectie */
.workout-tips {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-top: 30px;
    text-align: left;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.workout-tips h4 {
    color: #FF914B;
    margin-bottom: 15px;
    font-size: 16px;
}

.workout-tips ul {
    list-style: none;
    padding: 0;
}

.workout-tips li {
    padding: 8px 0;
    padding-left: 25px;
    position: relative;
    color: #555;
    font-size: 14px;
}

.workout-tips li:before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: #4CAF50;
    font-weight: bold;
}

/* Action buttons verbetering */
.workout-actions {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-top: 40px;
    align-items: center;
}

.add-exercise-btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
}

.add-exercise-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.btn-icon {
    font-size: 20px;
}

/* Motivatie boodschap */
.motivation-message {
    text-align: center;
    padding: 20px;
    margin-top: 30px;
    animation: fadeInUp 0.5s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.motivation-text {
    color: #FF914B;
    font-weight: 500;
    font-size: 16px;
}

/* Input verbetering */
.workout-name-input {
    font-size: 18px;
    padding: 15px;
    border: 2px solid #e0e0e0;
    transition: all 0.3s ease;
}

.workout-name-input:focus {
    border-color: #FF914B;
    transform: scale(1.02);
}

/* Responsive */
@media (max-width: 768px) {
    .progress-steps {
        gap: 10px;
    }

    .step-label {
        font-size: 10px;
        max-width: 80px;
    }

    .suggestion-chips {
        justify-content: center;
    }
}
</style>

<script>
// Workout naam suggesties
function setWorkoutName(name) {
    const input = document.querySelector('input[name="name"]');
    input.value = name;
    input.focus();
    checkWorkoutName();

    // Animatie feedback
    input.style.backgroundColor = '#fffbf0';
    setTimeout(() => {
        input.style.backgroundColor = '';
    }, 500);
}

// Check of workout naam is ingevuld
function checkWorkoutName() {
    const nameInput = document.querySelector('input[name="name"]');
    const submitBtn = document.getElementById('submit-btn');
    const addExerciseBtn = document.getElementById('add-exercise-btn');
    const emptyState = document.getElementById('empty-state');
    const exerciseInstruction = document.getElementById('exercise-instruction');
    const motivationMsg = document.getElementById('motivation');

    if (nameInput.value.trim().length > 0) {
        // Activeer stap 2
        document.querySelector('.step[data-step="2"]').classList.add('active');

        // Toon oefening instructies en knop
        addExerciseBtn.style.display = 'inline-flex';
        exerciseInstruction.style.display = 'block';
        submitBtn.disabled = false;

        // Update empty state
        emptyState.querySelector('h3').textContent = 'Klaar om oefeningen toe te voegen!';
        emptyState.querySelector('p').textContent = 'Klik op "Voeg oefening toe" om te beginnen';

        // Toon motivatie
        motivationMsg.style.display = 'block';
    } else {
        // Reset naar stap 1
        document.querySelector('.step[data-step="2"]').classList.remove('active');
        addExerciseBtn.style.display = 'none';
        exerciseInstruction.style.display = 'none';
        submitBtn.disabled = true;
        motivationMsg.style.display = 'none';
    }
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.querySelector('input[name="name"]');

    // Check naam bij laden
    checkWorkoutName();

    // Check naam bij typen
    nameInput.addEventListener('input', checkWorkoutName);

    // Focus op naam input bij laden
    nameInput.focus();

    // Animatie voor empty state
    const emptyState = document.querySelector('.empty-workout-state');
    if (emptyState) {
        setTimeout(() => {
            emptyState.style.opacity = '0';
            emptyState.style.transform = 'scale(0.95)';
            setTimeout(() => {
                emptyState.style.opacity = '1';
                emptyState.style.transform = 'scale(1)';
            }, 100);
        }, 500);
    }
});

// Drag-and-drop functionality (behouden van origineel)
document.querySelectorAll('.active-workout-block').forEach(block => {
    block.setAttribute('draggable', true);
    block.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', e.target.dataset.exerciseId);
    });
});

document.querySelector('.exercise-blok-section').addEventListener('dragover', (e) => {
    e.preventDefault();
});

document.querySelector('.exercise-blok-section').addEventListener('drop', (e) => {
    e.preventDefault();
    const exerciseId = e.dataTransfer.getData('text/plain');
    const droppedBlock = document.querySelector(`[data-exercise-id="${exerciseId}"]`);
    const targetBlock = e.target.closest('.active-workout-block');
    if (targetBlock && droppedBlock !== targetBlock) {
        e.target.closest('.exercise-blok-section').insertBefore(droppedBlock, targetBlock);
        updateExerciseOrder();
    }
});

// Update exercise order
function updateExerciseOrder() {
    const blocks = document.querySelectorAll('.active-workout-block');
    const order = Array.from(blocks).map(block => block.dataset.exerciseId).filter(id => id);

    // Activeer stap 3 als er oefeningen zijn
    if (order.length > 0) {
        document.querySelector('.step[data-step="3"]').classList.add('active');
    }
}
</script>

{% endblock %}